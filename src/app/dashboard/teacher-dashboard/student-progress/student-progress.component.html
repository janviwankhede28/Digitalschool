<div class="card bg-white h-100 shadow-sm">

  <!-- Header -->
  <div class="card-header bg-white border-bottom">

    <div class="d-flex flex-column flex-md-row justify-content-between align-items-md-center gap-3">

      <!-- Title -->
      <h5 class="mb-0 text-dark fw-bold d-flex align-items-center">
        <i class="bi bi-bar-chart-line-fill me-2 text-warning"></i>
        Student Progress
      </h5>

      <!-- Filters -->
      <div class="d-flex flex-wrap gap-2">

        <select
          class="form-select form-select-sm"
          style="min-width: 150px"
          [(ngModel)]="selectedClass"
          (change)="loadStudents()"
        >
          <option value="">Select Class</option>
          <option *ngFor="let c of classes">{{ c }}</option>
        </select>

        <select
          class="form-select form-select-sm"
          style="min-width: 150px"
          [(ngModel)]="selectedStudent"
        >
          <option value="">Select Student</option>
          <option *ngFor="let s of filteredStudents">{{ s.name }}</option>
        </select>

        <button
          class="btn btn-sm btn-warning w-100 w-md-auto"
          (click)="generateProgress()"
          [disabled]="!selectedStudent"
        >
          <i class="bi bi-graph-up"></i> Show Progress
        </button>

      </div>

    </div>

  </div>

  <!-- Body -->
  <div class="card-body">

    <!-- Progress Details -->
    <div *ngIf="progressData; else selectPrompt">

      <h6 class="fw-bold text-dark mb-3">
        Performance Summary: 
        <span class="text-warning">{{ selectedStudent }}</span>
      </h6>

      <!-- Responsive Table Wrapper -->
      <div class="table-responsive mb-4">
        <table class="table table-bordered align-middle text-center">
          <thead class="table-light">
            <tr>
              <th>Subject</th>
              <th style="min-width: 200px;">Marks (%)</th>
              <th>Status</th>
            </tr>
          </thead>

          <tbody>
            <tr *ngFor="let p of progressData.subjects">
              <td>{{ p.subject }}</td>

              <td>
                <div class="progress" style="height: 20px;">
                  <div
                    class="progress-bar bg-warning fw-bold text-dark"
                    role="progressbar"
                    [style.width.%]="p.score"
                  >
                    {{ p.score }}%
                  </div>
                </div>
              </td>

              <td>
                <span
                  [ngClass]="{
                    'badge bg-success': p.score >= 75,
                    'badge bg-warning text-dark': p.score < 75 && p.score >= 50,
                    'badge bg-danger': p.score < 50
                  }"
                >
                  {{ p.score >= 75 ? 'Excellent' : p.score >= 50 ? 'Average' : 'Poor' }}
                </span>
              </td>
            </tr>
          </tbody>

        </table>
      </div>

      <!-- Overall Performance -->
      <div class="card bg-light border-0 p-3 shadow-sm">
        <h6 class="fw-semibold text-secondary mb-2">
          <i class="bi bi-clipboard-data text-warning me-1"></i>
          Overall Performance
        </h6>

        <p class="text-dark mb-1">
          Average Score:
          <span class="fw-bold text-warning">{{ progressData.average }}%</span>
        </p>

        <p class="text-dark mb-0">
          Remarks:
          <span class="fw-bold text-success">{{ progressData.remark }}</span>
        </p>
      </div>

    </div>

    <!-- Select Prompt -->
    <ng-template #selectPrompt>
      <div class="text-center text-secondary py-5">
        <i class="bi bi-bar-chart text-warning display-6 d-block mb-2"></i>
        Please select a class and student to view progress.
      </div>
    </ng-template>

  </div>

</div>
